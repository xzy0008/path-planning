clear path
clc
% 
% data=	[0.00	0.00	0.00	0.00	5.0;
% 		35.36	35.36	0.00	0.00	5.0;
% 		53.39	42.82	53.39	17.32	5.0;
% 		82.04	50.50	53.39	100.12	5.0;
% 		125.34	75.50	82.04	50.50	5.0;
% 		153.99	58.96	134.89	58.96	5.0;
% 		153.99	8.96	153.99	58.96	5.0;
% 		141.29	-3.74	141.29	8.96	5.0;
% 		114.28	-14.93	141.29	-41.94	5.0;
% 		66.02	-63.19	114.28	-14.93	5.0;
% 		19.98	-65.20	41.90	-39.08	5.0;
% 		2.20	-50.28	19.98	-65.20	5.0;
% 		0.00	0.00	24.13	-24.13	5.0];
% 	
% data(:,[1 3])=data(:,[1 3])+17409;
% data(:,[2 4])=data(:,[2 4])-786.35;
% 
% dlmwrite('line_arc_track.txt',data,' ');

data=load('line_arc_track.txt');

path.end.E=data(:,1);
path.end.N=data(:,2);
path.center.E=data(:,3);
path.center.N=data(:,4);
path.speed=data(:,5);

j=1;
path.plot.E=path.end.E(1);
path.plot.N=path.end.N(1);
for i=2:length(path.speed)
	% determine if points describe line or arc
    %   - section if a line if the end and center are the same point
    %   - a section is an arc if the end and center are not he same point
	if ((abs(path.end.E(i-1)-path.center.E(i))<0.01)&(abs(path.end.N(i-1)-path.center.N(i))<0.01))
		% section is a line
        j=j+1;
		path.plot.E(j)=path.end.E(i);
		path.plot.N(j)=path.end.N(i);
		type(i)='l';
    else
		% section is an arc
        R=sqrt((path.end.E(i)-path.center.E(i))^2+(path.end.N(i)-path.center.N(i))^2);  %determine radius
		theta_min=atan2(path.end.E(i-1)-path.center.E(i),path.end.N(i-1)-path.center.N(i));
		theta_max=atan2(path.end.E(i)-path.center.E(i),path.end.N(i)-path.center.N(i));
		theta=linspace(theta_min,theta_max,100);    % generates 100 equally spaced ponts between theta_min and theta_max
		path.plot.E(j+1:j+100)=path.center.E(i)+R*sin(theta);
        path.plot.N(j+1:j+100)=path.center.N(i)+R*cos(theta);

        if (length(path.plot.E)<=(j+2))
            % if the heading of the curve is off by over 10 deg (usually by 180
            % deg) add 360 deg to theta_max to make the curve the right
            % direction
            head_err=abs(atan2(path.plot.E(j+2)-path.plot.E(j+1),path.plot.N(j+2)-path.plot.N(j+1))...
                -atan2(path.plot.E(j)-path.plot.E(j-1),path.plot.N(j)-path.plot.N(j-1)));

            if ~((head_err<10*pi/180)|(abs(head_err-2*pi)<10*pi/180))
                theta_max=theta_max+2*pi;
                theta=linspace(theta_min,theta_max,100);
                path.plot.E(j+1:j+100)=path.center.E(i)+R*sin(theta);
                path.plot.N(j+1:j+100)=path.center.N(i)+R*cos(theta);
            end
        end
        
		j=j+100;
		type(i)='a';
	end
end

figure(1)
clf
hold on
plot(path.plot.E,path.plot.N,'k')
plot(path.end.E,path.end.N,'rx')
plot(path.center.E,path.center.N,'bo')
axis equal
