%--------------------------------------------------------
% Miscellaneous Geometry Calculations for Line Tracker 

clear

% solve for intersection of arc and line
% used to find desired heading when on arc segment
%   psi - current vehicle heading
%   x1  - current vehicle x coordinate
%   y1  - current vehicle y coordinate
%   r   - radius of arc
%   h   - center of arc - x coordinate
%   k   - center of arc - y coordinate
syms x y h k r x1 y1 psi
[x_s,y_s]=solve(['(x-h)^2+(y-k)^2=r^2'],['y=(-1/cot(psi))*x+y1+(1/cot(psi))*x1'],x,y)
%[x_s,y_s]=solve(['(x-h)^2+(y-k)^2=r^2'],['y=cot(psi)*x+y1-cot(psi)*x1'],x,y)
point_x=inline(simplify(x_s))
point_y=inline(simplify(y_s))


% derivative of circle equation
syms y x k h r
% solve circle equation in terms of y
y_circ=solve(['(x-h)^2+(y-k)^2=r^2'],y)
% differentiate circle equation with respect to x
diff(y_circ,x)


% solve for intersection of two lines
% used to find lateral error when tracking line segment
syms x y n1 n2 e1 e2 psi x1 y1
[x_s,y_s]=solve(['y=(n2-n1)/(e2-e1)*x+n1-(n2-n1)/(e2-e1)*e1'],['y=(-1/cot(psi))*x+y1+(1/cot(psi))*x1'],x,y)
point_x=inline(simplify(x_s))
point_y=inline(simplify(y_s))
